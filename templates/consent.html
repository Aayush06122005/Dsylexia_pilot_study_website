<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informed Consent - Dyslexia Research Study</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='landing_style.css') }}">

</head>
<body>
    <!-- Header -->
    <header class="primary-bg text-white py-6">
        <div class="content-wrapper flex justify-between items-center">
            <div class="flex items-center">
                <h1 class="text-xl md:text-2xl font-bold">Leveraging NLP for Dyslexia Identification</h1>
            </div>
            <nav>
                <ul class="flex space-x-6 text-lg md:text-xl">
                    <li><a href="{{ url_for('landing') }}#about" class="hover:text-yellow-100 transition">About</a></li>
                    
                    <li><a href="{{ url_for('landing') }}#contact" class="hover:text-yellow-100 transition">Contact</a></li>

                    
                </ul> 
            </nav>
        </div>    
    </header>

    {% include 'partials/accessibility.html' %}
<!-- Progress Indicator -->
    <div class="content-wrapper mt-8">
        <div class="progress-indicator">
            <div class="progress-step completed">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span class="progress-label">Sign Up</span>
            </div>
            <div class="progress-step active">
                <span>2</span>
                <span class="progress-label">Informed Consent</span>
            </div>
            <div class="progress-step">
                <span>3</span>
                <span class="progress-label">Profile Setup</span>
            </div>
            
        </div>
    </div>

    <!-- Informed Consent Section -->
    <section class="py-8">
        <div class="content-wrapper">
            <div class="bg-white rounded-xl shadow-md overflow-hidden ">
                <div class="primary-bg text-white p-6">
                    <h2 class="text-2xl font-bold">Informed Consent</h2>
                    <p class="mt-2 text-white text-opacity-90">Please review the information below carefully before deciding to participate</p>
                </div>
                
                <div class="p-6">
                    <div class="mb-6">
                        <p class="text-gray-700">Before you can participate in this research study, we need your informed consent. Please read the following information carefully. You can download a copy for your records.</p>
                        
                        <div class="mt-4 flex justify-end">
                            <button id="downloadConsent" class="flex items-center text-primary-blue hover:text-blue-700 transition">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                </svg>
                                Download Consent Form
                            </button>
                        </div>
                    </div>
                    
                    <div class="consent-content mb-6 text-gray-700 border-2 border-gray-500 ">
                        <div class="consent-section">
                            <h3 class="text-lg font-semibold mb-3">1. Study Purpose</h3>
                            <p class="mb-3">This research study aims to develop and validate natural language processing (NLP) techniques for identifying linguistic patterns associated with dyslexia. The goal is to create accessible, non-invasive screening tools that can help identify dyslexia earlier and more efficiently.</p>
                            <p>By analyzing writing samples and reading patterns, we hope to identify subtle linguistic markers that may indicate dyslexia, potentially leading to earlier intervention and support for those who need it.</p>
                        </div>
                        
                        <div class="consent-section">
                            <h3 class="text-lg font-semibold mb-3">2. Procedures</h3>
                            <p class="mb-3">If you agree to participate, you will be asked to complete the following activities:</p>
                            <ul class="list-disc pl-5 space-y-2 mb-3">
                                <li>Complete a brief demographic questionnaire (approximately 5 minutes)</li>
                                <li>Provide information about any previous dyslexia diagnosis or related learning differences</li>
                                <li>Complete a series of reading and writing tasks (approximately 30-45 minutes total)</li>
                                <li>Optionally participate in follow-up assessments (if you agree to be contacted again)</li>
                            </ul>
                            <p>The total time commitment is approximately 35-50 minutes for the initial session.</p>
                        </div>
                        
                        <div class="consent-section">
                            <h3 class="text-lg font-semibold mb-3">3. Potential risks and Discomforts(minimal)</h3>
                            <p class="mb-3">The risks associated with this study are minimal and similar to those you might experience when doing reading or writing activities in everyday life:</p>
                            <ul class="list-disc pl-5 space-y-2 mb-3">
                                <li>You may experience mild fatigue from completing the tasks</li>
                                <li>If you have reading difficulties, some tasks might cause mild frustration</li>
                                <li>You might feel some discomfort if you're concerned about your performance</li>
                            </ul>
                            <p>We've designed the study to minimize these risks by allowing breaks between tasks and emphasizing that this is not a test with "right" or "wrong" answers.</p>
                        </div>
                        
                        <div class="consent-section">
                            <h3 class="text-lg font-semibold mb-3">4. Benefits</h3>
                            <p class="mb-3">While you may not benefit directly from participating in this study, your contribution will help advance our understanding of dyslexia and potentially lead to:</p>
                            <ul class="list-disc pl-5 space-y-2 mb-3">
                                <li>Development of more accessible screening tools for dyslexia</li>
                                <li>Earlier identification and intervention for individuals with dyslexia</li>
                                <li>Improved understanding of the linguistic patterns associated with dyslexia</li>
                            </ul>
                            <p>If you're interested, we can provide you with a summary of the research findings when the study is complete.</p>
                        </div>
                        
                        <div class="consent-section">
                            <h3 class="text-lg font-semibold mb-3">5. Confidentiality</h3>
                            <p class="mb-3">We take the protection of your data very seriously:</p>
                            <ul class="list-disc pl-5 space-y-2 mb-3">
                                <li>All data will be stored securely on encrypted servers</li>
                                <li>Your personal information (name, email) will be stored separately from your study data</li>
                                <li>A random participant ID will be used to link your data without identifying you</li>
                                <li>Only authorized research team members will have access to the full dataset</li>
                                <li>Any published results will use aggregated data and will not identify individual participants</li>
                            </ul>
                            <p>In accordance with research best practices, we will retain the anonymized data for 5 years after study completion.</p>
                        </div>
                        
                        <div class="consent-section">
                            <h3 class="text-lg font-semibold mb-3">6. Data Usage Statement</h3>
                            <p class="mb-3">The data collected in this study will be:</p>
                            <ul class="list-disc pl-5 space-y-2 mb-3">
                                <li>Anonymized (all personally identifying information removed)</li>
                                <li>Used for research purposes to develop and validate NLP models for dyslexia identification</li>
                                <li>Potentially included in a public research dataset, pending ethical approval</li>
                                <li>Used in academic publications, presentations, and reports</li>
                            </ul>
                            <p>If a public dataset is created, it will only include anonymized linguistic data and basic demographic information (age range, education level, etc.) with no personally identifying details.</p>
                        </div>
                        
                        <div class="consent-section">
                            <h3 class="text-lg font-semibold mb-3">7. Voluntary Participation and Right to Withdraw</h3>
                            <p class="mb-3">Your participation in this study is completely voluntary. You may:</p>
                            <ul class="list-disc pl-5 space-y-2 mb-3">
                                <li>Decline to participate without any penalty or loss of benefits</li>
                                <li>Skip any questions you prefer not to answer</li>
                                <li>Take breaks during the tasks as needed</li>
                                <li>Withdraw from the study at any time without penalty</li>
                            </ul>
                            <p>If you choose to withdraw, you can request that your data be removed from the study by contacting the research team within 30 days of your participation.</p>
                        </div>
                        
                        <div class="consent-section">
                            <h3 class="text-lg font-semibold mb-3">8. Contact Information</h3>
                            <p class="mb-3">If you have questions, concerns, or complaints about this research, please contact:</p>
                            <p class="mb-2"><strong>Principal Investigator:</strong> Dr. [name]</p>
                            <p class="mb-2">Email: [email]</p>
                            <p class="mb-2">Phone: [#1]</p>
                            <p class="mb-3">Department of [], IIITD Research Center</p>
                            
                            <p class="mb-2"><strong>For questions about your rights as a research participant:</strong></p>
                            <p class="mb-2">Institutional Review Board (IRB)</p>
                            <p class="mb-2">Email: [email2]</p>
                            <p>Phone: [#2]</p>
                        </div>
                    </div>
                    
                    <form id="consentForm" class="space-y-6">
                        <!-- Consent Checkbox -->
                        <div class="flex items-start">
                            <div class="flex items-center h-5">
                                <input id="consentCheckbox" name="consentCheckbox" type="checkbox" class="h-4 w-4 text-primary-blue focus:ring-primary-blue border-gray-700 rounded" required>
                            </div>
                            <div class="ml-3 text-sm">
                                <label for="consentCheckbox" class="font-medium text-gray-700">I have read and understood the information above and consent to participate in this research study.</label>
                                <div id="consentCheckboxError" class="error-message hidden"></div>
                            </div>
                        </div>
                        
                        <!-- Date -->
                        <div>
                            <label for="consentDate" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                            <input type="date" id="consentDate" name="consentDate" class="w-full px-4 py-2 border-2 border-gray-700  rounded-md focus:outline-none focus:ring-2 focus:ring-primary-blue" required>
                            <div id="consentDateError" class="error-message hidden"></div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="flex flex-col sm:flex-row justify-between space-y-4 sm:space-y-0 sm:space-x-4">
                            <button type="button" id="declineButton" class="px-6 py-2 border-2 border-gray-700 rounded-md text-gray-700 hover:bg-gray-50 transition">
                                Decline
                            </button>
                            <button type="submit" id="agreeButton" class="primary-bg hover:bg-blue-600 text-white font-medium py-2 px-6 rounded-md transition" style="background-color: #1A237E;">
                                Agree and Continue
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Decline Modal (hidden by default) -->
            <div id="declineModal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
                <div class="absolute inset-0 bg-black opacity-50"></div>
                <div class="bg-white rounded-lg p-8 max-w-md w-full relative z-10">
                    <div class="text-center">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
                            <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">Participation Declined</h3>
                        <p class="text-sm text-gray-600 mb-6">
                            Thank you for your interest in our study. We respect your decision not to participate. You will not be able to proceed with the study tasks, but you're welcome to return and consent at any time if you change your mind.
                        </p>
                        <div class="flex justify-center">
                            <button id="returnToHomeButton" class="primary-bg hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-md transition" style="background-color: #1A237E;">
                                Return to Home
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Success Modal (hidden by default) -->
            <div id="successModal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
                <div class="absolute inset-0 bg-black opacity-50"></div>
                <div class="bg-white rounded-lg p-8 max-w-md w-full relative z-10">
                    <div class="text-center">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
                            <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">Thank You!</h3>
                        <p class="text-sm text-gray-600 mb-6">
                            Your consent has been recorded. You can now proceed with the study tasks. Thank you for your participation in this important research.
                        </p>
                        <div class="flex justify-center">
                            <button id="continueButton" class="primary-bg hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-md transition" style="background-color: #1A237E;">
                                Continue to Profile Setup
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    {% include 'partials/footer.html' %}

    {% include 'partials/accessibility_script.html' %}
        px`);
            document.body.style.fontSize = `${currentFontSize}px`;
            root.style.fontSize = `${currentFontSize}px`;
        }

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });


        // Download consent form
        document.addEventListener('DOMContentLoaded', function() {
            const downloadBtn = document.getElementById('downloadConsent');
            
            if (downloadBtn) {
                downloadBtn.addEventListener('click', function() {
                    // Get the consent content
                    const consentContent = document.querySelector('.consent-content').innerText;
                    
                    // Create a Blob with the content
                    const blob = new Blob([consentContent], { type: 'text/plain' });
                    
                    // Create a download link
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'dyslexia_research_consent_form.txt';
                    
                    // Append to the document, click it, and remove it
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                });
            }
        });

        // Form validation and submission
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded event triggered');
            const form = document.getElementById('consentForm');
            const consentCheckbox = document.getElementById('consentCheckbox');
            const consentDate = document.getElementById('consentDate');
            const declineButton = document.getElementById('declineButton');
            const declineModal = document.getElementById('declineModal');
            const returnToHomeButton = document.getElementById('returnToHomeButton');
            const successModal = document.getElementById('successModal');
            const continueButton = document.getElementById('continueButton');
            
            console.log('Form elements found:', {
                form: !!form,
                consentCheckbox: !!consentCheckbox,
                consentDate: !!consentDate,
                declineButton: !!declineButton,
                declineModal: !!declineModal,
                returnToHomeButton: !!returnToHomeButton,
                successModal: !!successModal,
                continueButton: !!continueButton
            });
            
            const urlParams = new URLSearchParams(window.location.search);
            const childId = urlParams.get('child_id');
            console.log('Child ID from URL:', childId);

            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            if (consentDate) {
                consentDate.value = today;
            }
            
            if (form && consentCheckbox && consentDate && declineButton && declineModal && returnToHomeButton && successModal && continueButton) {
                console.log('All form elements found, setting up event listeners');
                
                // Handle form submission
                console.log('Adding submit event listener to form');
                form.addEventListener('submit', function(e) {
                    console.log('Form submit event triggered');
                    e.preventDefault();
                    console.log('Form submission prevented, handling manually');
                    
                    let isValid = true;
                    
                    // Validate consent checkbox
                    if (!consentCheckbox.checked) {
                        console.log('Consent checkbox not checked');
                        showError(null, 'consentCheckboxError', 'You must consent to participate in the study');
                        isValid = false;
                    } else {
                        console.log('Consent checkbox checked');
                        hideError(null, 'consentCheckboxError');
                    }
                    
                    // Validate date
                    if (consentDate.value === '') {
                        console.log('Date not entered');
                        showError(consentDate, 'consentDateError', 'Please enter today\'s date');
                        isValid = false;
                    } else {
                        console.log('Date entered:', consentDate.value);
                        hideError(consentDate, 'consentDateError');
                    }
                    
                    console.log('Form validation result:', isValid);
                    
                    // If form is valid, show success modal
                    if (isValid) {
                        console.log('Form is valid, proceeding with consent submission');
                        
                        // Record consent status and timestamp
                        const consentData = {
                            consent_given: true,
                            consent_date: new Date().toISOString().slice(0, 19).replace('T', ' '),
                        };
                        console.log('Sending consent data:', consentData);
                        console.log('API URL:', '/api/consent');
                        console.log('Child ID:', childId);
                        
                        // Send to backend
                        let apiUrl = '/api/consent'
                        if (childId) {
                            apiUrl += '?child_id=' + encodeURIComponent(childId);
                        }
                        console.log('Full API URL:', apiUrl);
                        
                        fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(consentData)
                        })
                        .then(response => {
                            console.log('Fetch response:', response);
                            return response.json();
                        })
                        .then(data => {
                            console.log('Consent API response:', data);
                            if (data.success) {
                                console.log('Consent recorded successfully, showing success modal');
                                // Show success modal
                                successModal.classList.remove('hidden');
                            } else {
                                console.error('Failed to record consent:', data.message);
                                alert('Failed to record consent: ' + data.message);
                            }
                        })
                        .catch((error) => {
                            console.error('Error recording consent:', error);
                            alert('Error recording consent. Please try again.');
                        });
                    } else {
                        console.log('Form validation failed');
                    }
                });
                
                // Handle decline button
                declineButton.addEventListener('click', function() {
                    // Record decline status
                    const declineData = {
                        consented: false,
                        timestamp: new Date().toISOString()
                    };
                    
                    // Store decline data in localStorage (in a real app, this would be sent to a server)
                    localStorage.setItem('consentData', JSON.stringify(declineData));
                    
                    // Show decline modal
                    declineModal.classList.remove('hidden');
                });
                
                // Handle return to home button
                returnToHomeButton.addEventListener('click', function() {
                    // In a real application, you would redirect to the home page
                    window.location.href = "/";
                });
                
                // Handle continue button
                continueButton.addEventListener('click', function() {
                    // In a real application, you would redirect to the profile setup page
                    // After successful child creation
                    window.location.href = '/profile-setup?child_id=' + childId;
                });
                
                // Helper functions for validation
                function showError(input, errorId, message) {
                    const errorElement = document.getElementById(errorId);
                    errorElement.textContent = message;
                    errorElement.classList.remove('hidden');
                    if (input) {
                        input.classList.add('input-error');
                    }
                }
                
                function hideError(input, errorId) {
                    const errorElement = document.getElementById(errorId);
                    errorElement.textContent = '';
                    errorElement.classList.add('hidden');
                    if (input) {
                        input.classList.remove('input-error');
                    }
                }
                
                // Close modals when clicking outside
                window.addEventListener('click', function(e) {
                    if (e.target === declineModal) {
                        declineModal.classList.add('hidden');
                    }
                    if (e.target === successModal) {
                        successModal.classList.add('hidden');
                    }
                });
            } else {
                console.log('Not all form elements found, cannot set up event listeners');
                console.log('Missing elements:', {
                    form: !form,
                    consentCheckbox: !consentCheckbox,
                    consentDate: !consentDate,
                    declineButton: !declineButton,
                    declineModal: !declineModal,
                    returnToHomeButton: !returnToHomeButton,
                    successModal: !successModal,
                    continueButton: !continueButton
                });
            }
        });
    </script>
</body>
</html>