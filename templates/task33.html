<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reading Comprehension Task - Dyslexia Research Study</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='landing_style.css') }}">
</head>
<body>
    <!-- Header -->
    <header class="primary-bg text-white py-6">
        <div class="content-wrapper flex justify-between items-center">
            <div class="flex items-center">
                <img src="{{ url_for('static', filename='comprehend.jpg') }}" alt="Comprehension Task" class="h-12 w-12 rounded-full mr-4 hidden md:block">
                <h1 class="text-xl md:text-2xl font-bold">Reading Comprehension Task</h1>
            </div>
            <nav>
                <ul class="flex space-x-6 text-lg md:text-xl items-center">
                    <li><a href="{{ url_for('landing') }}#about" class="hover:text-yellow-100 transition">About</a></li>
                    <li><a href="{{ url_for('landing') }}#contact" class="hover:text-yellow-100 transition">Contact</a></li>
                    <li><a href="/participant-dashboard" class="hover:text-yellow-100 transition ">Dashboard</a></li>
                    <li><a href="#" id="logoutBtn" class="hover:text-yellow-100 transition ">Logout</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Accessibility Button with Label -->
    <div class="fixed bottom-4 left-4 z-50 flex flex-col items-center space-y-1">
        <button id="togglePanel"
            class="bg-[#1A237E] text-white p-3 rounded-full shadow-lg hover:bg-[#3a74cc] transition border border-white"
            aria-label="Toggle Accessibility Panel">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
                viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M12 4.5c.828 0 1.5-.672 1.5-1.5S12.828 1.5 12 1.5 10.5 2.172 10.5 3s.672 1.5 1.5 1.5zM4.75 9.25l3.625.75M19.25 9.25l-3.625.75M8.375 10l.625 9m6-9l-.625 9M5.5 21.25h13"/>
            </svg>
        </button>
        <span class="text-sm text-white bg-[#1A237E] px-2 py-1 rounded shadow border border-white">
            Accessibility
        </span>
    </div>
    
    <!-- Reading ruler -->
    <div id="readingRuler" class="hidden pointer-events-none fixed top-0 left-0 w-full h-10 z-40" style="background-color: rgba(58, 116, 204, 0.3);">
    </div>
    
    <!-- Accessibility Panel -->
    <div id="accessibilityPanel"
        class="hidden fixed top-0 left-0 h-screen w-80 bg-white shadow-lg z-50 border-l border-gray-300 overflow-y-auto p-4 space-y-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-semibold text-[#1A237E]">Accessibility Menu</h2>
            <button id="closePanel" class="text-2xl font-bold text-gray-500 hover:text-gray-700">&times;</button>
        </div>

        <div class="flex items-center justify-between">
            <span>Font Size</span>
            <div class="space-x-2">
                <button id="fontDecrease" class="px-2 py-1 bg-gray-200 rounded">A-</button>
                <button id="fontReset" class="px-2 py-1 bg-gray-200 rounded">Reset</button>
                <button id="fontIncrease" class="px-2 py-1 bg-gray-200 rounded">A+</button>
            </div>
        </div>

        <div class="flex justify-between items-center">
            <span>Dyslexic Font</span>
            <button id="toggleDyslexic" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-300 transition-colors">
                <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-1"></span>
            </button>
        </div>

        <div class="flex justify-between items-center">
            <span>Monochrome</span>
            <button id="toggleMonochrome" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-300 transition-colors">
                <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-1"></span>
            </button>
        </div>

        <div class="flex justify-between items-center">
            <span>Reading Ruler</span>
            <button id="toggleRuler" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-300 transition-colors">
                <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-1"></span>
            </button>
        </div>

        <div class="flex justify-between items-center">
            <span>Big Cursor</span>
            <button id="toggleCursor" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-300 transition-colors">
                <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-1"></span>
            </button>
        </div>
    </div>

    <main class="flex justify-center items-center min-h-[60vh] bg-transparent my-16">
        <div class="w-full max-w-2xl bg-white rounded-2xl shadow-lg p-8 flex flex-col items-center border border-gray-200">
            <div class="flex items-center gap-4 mb-4">
                <img src="{{ url_for('static', filename='comprehend.jpg') }}" alt="Comprehension Task" class="w-16 h-16 object-cover rounded-xl shadow-md">
                <h2 class="text-2xl font-bold text-[#1A237E]">Reading Comprehension</h2>
            </div>
            <div class="mb-4 w-full rounded p-4">
                <span class="font-semibold">Instructions:</span>
                <ul class="list-disc pl-6 mt-2 text-gray-800 text-lg">
                    <li>If you are in a lab, please follow the instructions provided by the researcher for eye-tracker calibration before starting.</li>
                    <li>If you are using a web-based eye-tracker, please ensure your webcam is enabled and follow the on-screen calibration steps (if available).</li>
                    <li><b>Read</b> the passage below carefully. </li>
                    <li>You may take your time.</li>
                    <li>After reading, <b>answer</b> the comprehension questions.</li>
                    <li>Your responses will be recorded for research purposes.</li>
            </ul>
            </div>
            <div class="mb-6 w-full bg-gray-50 rounded p-4 border border-gray-200">
                <span class="font-semibold">Passage:</span>
                <p class="mt-2 text-gray-900 text-lg" style="line-height: 1.7;">
                    The sun was just rising over the quiet town, casting a golden glow on the rooftops. Children were slowly waking up, ready to start a new day filled with learning and adventure. In the heart of the town stood an old library, its doors open to all who wished to explore the world of books. For many, the library was a place of discovery, where stories came alive and imaginations soared. Today, a special event was plannedâ€”a reading challenge that would bring together young readers from every corner of the community.
                </p>
            </div>
            <form id="comprehensionForm" class="w-full flex flex-col gap-6">
                    <div>
                    <label for="q1" class="block font-semibold mb-2">1. What time of day is described in the passage?</label>
                    <input type="text" id="q1" name="q1" class="w-full border border-gray-300 rounded p-2 text-lg" required>
                    </div>
                <div>
                    <label for="q2" class="block font-semibold mb-2">2. Where did the special event take place?</label>
                    <select id="q2" name="q2" class="w-full border border-gray-300 rounded p-2 text-lg" required>
                        <option value="">Select an answer</option>
                        <option value="school">School</option>
                        <option value="library">Library</option>
                        <option value="park">Park</option>
                        <option value="museum">Museum</option>
                    </select>
                </div>
                <div>
                    <label for="q3" class="block font-semibold mb-2">3. Why was the library important to the community?</label>
                    <textarea id="q3" name="q3" rows="3" class="w-full border border-gray-300 rounded p-2 text-lg" required></textarea>
            </div>
                <div class="flex gap-4">
                    <button type="button" id="saveProgressBtn" class="bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold transition flex-1">Save Progress</button>
                    <button type="submit" id="submitBtn" class="primary-bg text-white px-6 py-3 rounded-lg font-semibold transition flex-1">Submit Answers</button>
            </div>
                <div id="formMsg" class="mt-2 text-green-700 font-semibold hidden"></div>
                <div id="returnDashboardContainer" class="mt-4 hidden">
                    <button id="returnDashboardBtn" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition">Return to Dashboard</button>
            </div>
            </form>
        </div>
    </main>
    
        <!-- Footer -->
        <footer class="dark-bg text-white py-12 text-lg" style="background-color: #333333;">
            <div class="content-wrapper">
                <div class="flex flex-col md:flex-row justify-between">
                    <div class="mb-8 md:mb-0">
                        <div class="flex items-center">
                            
                            <h2 class="text-xl font-bold">Dyslexia Research Initiative</h2>
                        </div>
                        <p class="mt-4 text-gray-400 max-w-md">
                            Advancing our understanding of dyslexia through innovative research and technology to create better support systems for everyone.
                        </p>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-8">
                        <div>
                            <h3 class="text-lg font-semibold mb-4">Quick Links</h3>
                            <ul class="space-y-2">
                                <li><a href="landing.html#about" class="text-gray-400 hover:text-white transition">About</a></li>
                                <li><a href="landing.html#contact" class="text-gray-400 hover:text-white transition">Contact</a></li>
                            </ul>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold mb-4">Resources</h3>
                            <ul class="space-y-2">
                                <li><a href="learn_more.html#faq" class="text-gray-400 hover:text-white transition">FAQs</a></li>
                                <li><a href="#" class="text-gray-400 hover:text-white transition">Privacy Policy</a></li>
                                <!-- <li><a href="#" class="text-gray-400 hover:text-white transition">Terms of Service</a></li> -->
                            </ul>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold mb-4">Connect</h3>
                            <div class="flex space-x-4">
                                <a href="#" class="text-gray-400 hover:text-white transition">
                                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z"></path>
                                    </svg>
                                </a>
                                <a href="#" class="text-gray-400 hover:text-white transition">
                                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.067.06 1.407.06 4.123v.08c0 2.643-.012 2.987-.06 4.043-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.067.048-1.407.06-4.123.06h-.08c-2.643 0-2.987-.012-4.043-.06-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.047-1.024-.06-1.379-.06-3.808v-.63c0-2.43.013-2.784.06-3.808.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 015.45 2.525c.636-.247 1.363-.416 2.427-.465C8.901 2.013 9.256 2 11.685 2h.63zm-.081 1.802h-.468c-2.456 0-2.784.011-3.807.058-.975.045-1.504.207-1.857.344-.467.182-.8.398-1.15.748-.35.35-.566.683-.748 1.15-.137.353-.3.882-.344 1.857-.047 1.023-.058 1.351-.058 3.807v.468c0 2.456.011 2.784.058 3.807.045.975.207 1.504.344 1.857.182.466.399.8.748 1.15.35.35.683.566 1.15.748.353.137.882.3 1.857.344 1.054.048 1.37.058 4.041.058h.08c2.597 0 2.917-.01 3.96-.058.976-.045 1.505-.207 1.858-.344.466-.182.8-.398 1.15-.748.35-.35.566-.683.748-1.15.137-.353.3-.882.344-1.857.048-1.055.058-1.37.058-4.041v-.08c0-2.597-.01-2.917-.058-3.96-.045-.976-.207-1.505-.344-1.858a3.097 3.097 0 00-.748-1.15 3.098 3.098 0 00-1.15-.748c-.353-.137-.882-.3-1.857-.344-1.023-.047-1.351-.058-3.807-.058zM12 6.865a5.135 5.135 0 110 10.27 5.135 5.135 0 010-10.27zm0 1.802a3.333 3.333 0 100 6.666 3.333 3.333 0 000-6.666zm5.338-3.205a1.2 1.2 0 110 2.4 1.2 1.2 0 010-2.4z" clip-rule="evenodd"></path>
                                    </svg>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-12 pt-8 border-t border-gray-700 text-center text-gray-400">
                    <p>&copy; 2025 Leveraging NLP for Dyslexia Identification. All rights reserved.</p>
                </div>
            </div>
        </footer>
    
        <script>
            // Accessibility functionality
            const root = document.documentElement;
            const panel = document.getElementById('accessibilityPanel');
            const panelToggle = document.getElementById('togglePanel');
            const closePanel = document.getElementById('closePanel');
            const decreaseBtn = document.getElementById('fontDecrease');
            const resetBtn = document.getElementById('fontReset');
            const increaseBtn = document.getElementById('fontIncrease');
    
            panelToggle.addEventListener('click', () => {
                panel.classList.toggle('hidden');
            });
    
            closePanel.addEventListener('click', () => {
                panel.classList.add('hidden');
            });
    
            document.addEventListener('click', function (event) {
                const isClickInsidePanel = panel.contains(event.target);
                const isClickToggleButton = panelToggle.contains(event.target);
    
                if (!isClickInsidePanel && !isClickToggleButton) {
                    panel.classList.add('hidden');
                }
            });
    
            function setupToggle(buttonId, classTarget, className) {
                const button = document.getElementById(buttonId);
                const thumb = button.querySelector('span');
    
                button.addEventListener('click', () => {
                    const isActive = classTarget.classList.toggle(className);
                    button.classList.toggle('bg-blue-600', isActive);
                    button.classList.toggle('bg-gray-300', !isActive);
                    thumb.classList.toggle('translate-x-6', isActive);
                    thumb.classList.toggle('translate-x-1', !isActive);
                });
            }
    
            setupToggle('toggleDyslexic', root, 'dyslexic-font');
            setupToggle('toggleMonochrome', root, 'monochrome');
            setupToggle('toggleCursor', root, 'big-cursor');
    
            // Reading ruler
            const ruler = document.getElementById('readingRuler');
            const rulerToggle = document.getElementById('toggleRuler');
            const rulerThumb = rulerToggle.querySelector('span');
            let rulerActive = false;
    
            rulerToggle.addEventListener('click', () => {
                rulerActive = !rulerActive;
                ruler.classList.toggle('hidden', !rulerActive);
                rulerToggle.classList.toggle('bg-blue-600', rulerActive);
                rulerToggle.classList.toggle('bg-gray-300', !rulerActive);
                rulerThumb.classList.toggle('translate-x-6', rulerActive);
                rulerThumb.classList.toggle('translate-x-1', !rulerActive);
            });
    
            document.addEventListener('mousemove', (e) => {
                if (rulerActive) {
                    const height = ruler.offsetHeight;
                    ruler.style.top = `${e.clientY - height / 2}px`;
                }
            });
    
            // Font size controls
            let currentFontSize = 16;
            decreaseBtn.addEventListener('click', () => {
                if (currentFontSize > 12) {
                    currentFontSize -= 1;
                    updateFontSize();
                }
            });
            resetBtn.addEventListener('click', () => {
                currentFontSize = 16;
                updateFontSize();
            });
            increaseBtn.addEventListener('click', () => {
                if (currentFontSize < 24) {
                    currentFontSize += 1;
                    updateFontSize();
                }
            });
    
            function updateFontSize() {
                document.documentElement.style.setProperty('--font-size-base', `${currentFontSize}px`);
                document.body.style.fontSize = `${currentFontSize}px`;
                root.style.fontSize = `${currentFontSize}px`;
            }
    
            // Logout functionality
            document.getElementById('logoutBtn').addEventListener('click', function() {
                fetch('/api/logout', {
                    method: 'POST',
                    credentials: 'same-origin',
                    headers: { 'Content-Type': 'application/json' }
                })
                .then(res => res.json())
                .then(data => {
                    localStorage.clear();
                    window.location.href = '/';
                })
                .catch(() => {
                    localStorage.clear();
                    window.location.href = '/';
                });
            });
    
    // Prefill answers and handle completed state
    let taskCompleted = false;
            document.addEventListener('DOMContentLoaded', function() {
        fetch('/api/get-comprehension-progress')
                .then(res => res.json())
                .then(data => {
                    if (data.success && data.progress) {
                document.getElementById('q1').value = data.progress.q1 || '';
                document.getElementById('q2').value = data.progress.q2 || '';
                document.getElementById('q3').value = data.progress.q3 || '';
                if (data.progress.status === 'Completed') {
                    taskCompleted = true;
                    document.getElementById('saveProgressBtn').disabled = true;
                    document.getElementById('submitBtn').disabled = true;
                    document.getElementById('formMsg').textContent = 'This task has already been submitted.';
                    document.getElementById('formMsg').classList.remove('hidden', 'text-red-600');
                    document.getElementById('formMsg').classList.add('text-green-700');
                }
            }
                });
            });

            // Save Progress
    const saveBtn = document.getElementById('saveProgressBtn');
    saveBtn.addEventListener('click', function() {
        if (taskCompleted) return;
        const q1 = document.getElementById('q1').value;
        const q2 = document.getElementById('q2').value;
        const q3 = document.getElementById('q3').value;
        fetch('/api/save-comprehension-progress', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({q1, q2, q3})
                })
                .then(res => res.json())
        .then(resp => {
            const msg = document.getElementById('formMsg');
            if (resp.success) {
                msg.textContent = 'Progress saved! Redirecting to dashboard...';
                msg.classList.remove('hidden', 'text-red-600');
                msg.classList.add('text-green-700');
                        setTimeout(() => {
                            window.location.href = '/participant-dashboard';
                }, 1200);
                    } else {
                msg.textContent = 'Save failed: ' + (resp.message || 'Unknown error');
                msg.classList.remove('hidden', 'text-green-700');
                msg.classList.add('text-red-600');
                    }
                })
                .catch(() => {
            const msg = document.getElementById('formMsg');
            msg.textContent = 'Save failed. Please try again.';
            msg.classList.remove('hidden', 'text-green-700');
            msg.classList.add('text-red-600');
                });
            });

    // Handle comprehension form submission
    const form = document.getElementById('comprehensionForm');
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        if (taskCompleted) return;
        const q1 = form.q1.value;
        const q2 = form.q2.value;
        const q3 = form.q3.value;
        fetch('/api/submit-comprehension', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({q1, q2, q3})
                })
                .then(res => res.json())
        .then(resp => {
            const msg = document.getElementById('formMsg');
            if (resp.success) {
                msg.textContent = 'Your answers have been submitted. Thank you!';
                msg.classList.remove('hidden', 'text-red-600');
                msg.classList.add('text-green-700');
                form.querySelector('button[type="submit"]').disabled = true;
                document.getElementById('saveProgressBtn').disabled = true;
                taskCompleted = true;
                document.getElementById('returnDashboardContainer').classList.remove('hidden');
                    } else {
                msg.textContent = 'Submission failed: ' + (resp.message || 'Unknown error');
                msg.classList.remove('hidden', 'text-green-700');
                msg.classList.add('text-red-600');
                    }
                })
                .catch(() => {
            const msg = document.getElementById('formMsg');
            msg.textContent = 'Submission failed. Please try again.';
            msg.classList.remove('hidden', 'text-green-700');
            msg.classList.add('text-red-600');
                });
            });

    // Add after successful submission:
    document.getElementById('returnDashboardBtn').addEventListener('click', function() {
                window.location.href = '/participant-dashboard';
            });
        </script>
 
</body>
</html> 